<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>README.md Generator with AI</title>

    <!-- Metadata for SEO and Social Sharing -->
    <meta name="description" content="Generator README.md kustom dan cerdas berbasis AI dari GitHub repository. Buat README yang profesional, menarik, dan unik dengan pilihan personalisasi." />
    <meta name="keywords" content="README generator, GitHub README generator, AI README maker, free markdown generator, custom readme, open source documentation, personalized readme" />
    <meta name="author" content="Your Name/AI" />
    <meta property="og:title" content="README.MD GENERATOR KUSTOM DENGAN AI" />
    <meta property="og:description" content="Generator README.md gratis berbasis AI untuk membuat dokumentasi GitHub yang profesional dan menarik, kini dengan opsi kustomisasi." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://your-app-url.com/" />
    <!-- Placeholder image URL, as dynamic images are not supported for og:image -->
    <meta property="og:image" content="https://placehold.co/1200x630/4c1d95/ffffff?text=README+Kustom+AI" />

    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <!-- GitHub Markdown CSS (Dark Theme) for preview consistency -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown-dark.min.css" xintegrity="sha512-VSsvlrOrYO3aEGGyspPXRjFbRhmM0T1Xv6UPUn1SgI2M2dxnJno7iNJWzF4U2zgv0i5ZM/j/I199g14P2i5QAQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      /* Custom styles for the application */
      body {
        font-family: "Inter", sans-serif;
      }

      /* Adjustments for markdown-body to ensure proper list and horizontal rule rendering */
      .markdown-body ul {
        list-style-type: disc;
        padding-left: 1.5em;
      }
      .markdown-body hr {
        border: none;
        border-top: 1px solid #444; /* Darker border for dark theme */
        margin: 1.5rem 0;
      }
      .markdown-body p {
        margin-bottom: 1rem;
      }
      /* Loading spinner animation */
      .lds-dual-ring {
        display: inline-block;
        width: 20px;
        height: 20px;
      }
      .lds-dual-ring:after {
        content: " ";
        display: block;
        width: 16px;
        height: 16px;
        margin: 2px;
        border-radius: 50%;
        border: 3px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: lds-dual-ring 1.2s linear infinite;
      }
      @keyframes lds-dual-ring {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      /* Custom details/summary styling for advanced settings */
      details > summary {
        list-style: none; /* Remove default marker */
      }
      details > summary::-webkit-details-marker {
        display: none; /* Remove WebKit specific marker */
      }
      /* Tag pill styling */
      .tag-pill {
        display: inline-flex;
        align-items: center;
        background-color: #6d28d9; /* Indigo-700 for tags */
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px; /* Full rounded */
        font-size: 0.875rem; /* text-sm */
        font-weight: 500; /* font-medium */
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .tag-remove-btn {
        margin-left: 0.5rem;
        width: 1rem;
        height: 1rem;
        background-color: #5b21b6; /* Darker indigo */
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: bold;
        line-height: 1;
        transition: background-color 0.2s;
      }
      .tag-remove-btn:hover {
        background-color: #4c1d95; /* Even darker indigo on hover */
      }
      /* Ensure markdown output preserves line breaks and word wrapping */
      #readmeOutput {
        white-space: pre-wrap;
        word-break: break-word;
      }
      /* Custom container for GitHub Markdown style preview */
      #pane-preview.markdown-body {
        box-sizing: border-box;
        background-color: #0d1117; /* GitHub dark background */
        padding: 2.5rem;
        border-radius: 0 0 0.5rem 0.5rem;
      }

      /* Responsive adjustments for preview pane */
      @media (max-width: 767px) {
        #pane-preview.markdown-body {
          padding: 1rem;
        }
      }

      /* Modal backdrop for blur effect */
      .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
      }
    </style>
  </head>
  <body class="bg-gray-950 text-white flex items-center justify-center min-h-screen p-4">
    <!-- Main Application Container -->
    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 border border-indigo-700">
      <div class="text-center mb-6 flex flex-col items-center justify-center gap-2">
        <div class="flex items-center gap-3">
          <!-- Custom SVG Icon for a distinct look -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <path d="M14 2v6h6"></path>
            <path d="M10 9H8"></path>
            <path d="M16 13H8"></path>
            <path d="M16 17H8"></path>
          </svg>

          <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-400">
            README Kustom AI
          </h1>
        </div>
        <p class="text-gray-300 text-sm md:text-base">
          Personalisasi dan Hasilkan README.md Profesional dengan Bantuan AI.
        </p>
      </div>

      <!-- Input Section -->
      <div class="space-y-4 mb-4">
        <div class="flex flex-col md:flex-row gap-4">
          <input
            type="text"
            id="githubUrl"
            placeholder="Tempel URL Repositori GitHub di sini..."
            class="flex-grow bg-gray-700 border border-indigo-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-500 transition"
          />
          <button
            id="generateBtn"
            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center transition shadow-lg shadow-indigo-500/30 transform hover:scale-105 active:scale-95"
          >
            <span id="btn-text">Hasilkan README</span>
            <div id="loader" class="lds-dual-ring hidden ml-2"></div>
          </button>
        </div>

        <!-- Section for adding documentation image/GIF links -->
        <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
          <label class="block text-sm font-medium text-gray-300 mb-2"
            >Link Gambar/GIF Dokumentasi (Opsional)</label
          >
          <div id="image-inputs-container" class="space-y-3"></div>
          <button
            id="add-image-btn"
            class="mt-3 text-sm bg-lime-700 hover:bg-lime-600 text-lime-100 font-semibold py-2 px-4 rounded-lg transition transform hover:scale-105 active:scale-95"
          >
            + Tambah Gambar
          </button>
        </div>

        <!-- Section for adding context tags -->
        <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
          <label
            for="tags-input"
            class="block text-sm font-medium text-gray-300 mb-2"
            >Tag Konteks (Tekan Enter untuk menambah)</label
          >
          <div id="tags-container" class="mb-2 flex flex-wrap gap-2"></div>
          <input
            type="text"
            id="tags-input"
            placeholder="e.g., react, nodejs, data visualization..."
            class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-500"
          />
        </div>

        <!-- New: Customization Options for README Content -->
        <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
            <h3 class="text-lg font-semibold text-gray-200 mb-3">Opsi Kustomisasi README ✨</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="toneSelect" class="block text-sm font-medium text-gray-300 mb-1">Nada/Gaya Bahasa:</label>
                    <select id="toneSelect" class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500">
                        <option value="professional">Profesional</option>
                        <option value="enthusiastic">Antusias & Energik</option>
                        <option value="casual">Kasual & Ramah</option>
                        <option value="technical">Sangat Teknis</option>
                    </select>
                </div>
                <div>
                    <label for="audienceSelect" class="block text-sm font-medium text-gray-300 mb-1">Target Audiens:</label>
                    <select id="audienceSelect" class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500">
                        <option value="developers">Developer</option>
                        <option value="end-users">Pengguna Akhir</option>
                        <option value="managers">Manajer Teknis</option>
                    </select>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">Pilih Bagian README:</label>
                <div id="sections-checkboxes" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm text-gray-200">
                    <!-- Checkboxes will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Advanced Settings (API Tokens) -->
        <details class="group">
          <summary
            class="cursor-pointer text-sm text-gray-400 hover:text-indigo-400 transition flex items-center"
          >
            <span class="font-medium flex-grow">Pengaturan Lanjutan</span>
            <!-- Simple arrow icon for expand/collapse -->
            <svg class="w-4 h-4 ml-2 transform group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
          </summary>
          <div class="mt-3 bg-gray-900/50 p-4 rounded-lg border border-gray-700 space-y-4">
            <div>
              <label
                for="githubToken"
                class="block text-sm font-medium text-gray-300 mb-1"
                >GitHub Personal Access Token</label
              >
              <div class="flex gap-3">
                <input
                  type="password"
                  id="githubToken"
                  placeholder="github_pat_..."
                  class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-500"
                />
                <button
                  id="save-github-token-btn"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition"
                >
                  Simpan
                </button>
              </div>
            </div>
            <div>
              <label
                for="geminiToken"
                class="block text-sm font-medium text-gray-300 mb-1"
                >Gemini API Key</label
              >
              <div class="flex gap-3">
                <input
                  type="password"
                  id="geminiToken"
                  placeholder="AIza..."
                  class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-500"
                />
                <button
                  id="save-gemini-token-btn"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition"
                >
                  Simpan
                </button>
              </div>
            </div>
          </div>
        </details>
      </div>

      <!-- Message Container for alerts/notifications -->
      <div id="message-container" class="mb-6"></div>

      <!-- Output Section (Markdown and Preview tabs) -->
      <div id="output-container" class="bg-gray-900 rounded-lg border border-indigo-700">
        <div class="flex border-b border-gray-700">
          <button
            id="tab-markdown"
            class="py-2 px-4 font-semibold text-white bg-gray-800 rounded-tl-lg focus:outline-none transition-colors"
          >
            Markdown
          </button>
          <button
            id="tab-preview"
            class="py-2 px-4 font-semibold text-gray-400 hover:bg-gray-800/50 rounded-tr-lg focus:outline-none transition-colors"
          >
            Pratinjau
          </button>
          <div class="flex-grow"></div>
          <button
            id="copyBtn"
            class="bg-indigo-700 hover:bg-indigo-600 text-gray-200 font-semibold my-auto py-1 px-3 rounded-lg text-sm transition transform hover:scale-105 active:scale-95"
          >
            Salin Teks
          </button>
        </div>
        <div id="pane-markdown" class="mt-4 p-4">
          <div
            id="readmeOutput"
            contenteditable="true"
            class="w-full min-h-[480px] bg-gray-800 border border-gray-700 rounded-lg p-4 text-gray-200 font-mono text-sm whitespace-pre-wrap focus:outline-none focus:ring-2 focus:ring-lime-500"
            placeholder="Hasil Markdown akan muncul di sini..."
          ></div>
        </div>
        <div
          id="pane-preview"
          class="hidden markdown-body max-w-none w-full min-h-[480px] overflow-y-auto p-4"
        >
          <p class="text-gray-500">Pratinjau akan muncul di sini...</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-6 text-gray-500 text-sm">
        Dibuat dengan <span class="text-red-500">&hearts;</span> oleh <span class="text-indigo-400">README Kustom AI</span>.
      </div>
    </div>

    <!-- API Keys Modal (hidden by default) -->
    <div
      id="api-keys-modal"
      class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop"
    >
      <div
        class="bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full p-8 space-y-6 transform transition-all border border-indigo-700"
      >
        <h2 class="text-2xl font-bold text-indigo-400">Pengaturan API Keys Penting</h2>
        <p class="text-gray-300">
          Untuk fungsionalitas penuh, Anda memerlukan kunci API berikut. Kunci ini
          hanya disimpan di browser Anda secara lokal dan tidak dikirim ke server mana pun.
        </p>
        <div class="space-y-4">
          <div>
            <label
              for="modal-github-token"
              class="block text-sm font-medium text-gray-300 mb-1"
              >GitHub Personal Access Token</label
            >
            <input
              type="password"
              id="modal-github-token"
              placeholder="github_pat_..."
              class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white"
            />
            <p class="mt-2 text-xs text-gray-500">
              Dibutuhkan untuk mengambil data repo.
              <a
                href="https://github.com/settings/tokens?type=beta"
                target="_blank"
                rel="noopener noreferrer"
                class="text-lime-500 hover:underline"
                >Buat token GitHub di sini</a
              >. Pilih scope `public_repo` atau `repo`.
            </p>
          </div>
          <div>
            <label
              for="modal-gemini-token"
              class="block text-sm font-medium text-gray-300 mb-1"
              >Gemini API Key</label
            >
            <input
              type="password"
              id="modal-gemini-token"
              placeholder="AIza..."
              class="w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white"
            />
            <p class="mt-2 text-xs text-gray-500">
              Dibutuhkan untuk generate konten AI.
              <a
                href="https://aistudio.google.com/app/apikey"
                target="_blank"
                rel="noopener noreferrer"
                class="text-lime-500 hover:underline"
                >Dapatkan key Gemini gratis di sini</a
              >.
            </p>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row gap-4">
          <button
            id="modal-save-keys-btn"
            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            Simpan & Lanjutkan
          </button>
          <button
            id="modal-close-btn"
            class="w-full bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>

    <script>
      // Ensures the DOM is fully loaded before executing JavaScript
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        // Input fields and buttons
        const githubUrlInput = document.getElementById("githubUrl");
        const generateBtn = document.getElementById("generateBtn");
        const copyBtn = document.getElementById("copyBtn");
        const loader = document.getElementById("loader");
        const btnText = document.getElementById("btn-text");

        // API token inputs (main and modal)
        const githubTokenInput = document.getElementById("githubToken");
        const saveGithubTokenBtn = document.getElementById("save-github-token-btn");
        const geminiTokenInput = document.getElementById("geminiToken");
        const saveGeminiTokenBtn = document.getElementById("save-gemini-token-btn");

        // Image input related elements
        const imageInputsContainer = document.getElementById("image-inputs-container");
        const addImageBtn = document.getElementById("add-image-btn");

        // Tag input related elements
        const tagsInput = document.getElementById("tags-input");
        const tagsContainer = document.getElementById("tags-container");

        // New customization options
        const toneSelect = document.getElementById("toneSelect");
        const audienceSelect = document.getElementById("audienceSelect");
        const sectionsCheckboxes = document.getElementById("sections-checkboxes");

        // Message display container
        const messageContainer = document.getElementById("message-container");

        // README output and preview panes
        const readmeOutput = document.getElementById("readmeOutput");
        const previewPane = document.getElementById("pane-preview");
        const markdownPane = document.getElementById("pane-markdown");

        // Tab buttons for Markdown and Preview
        const markdownTab = document.getElementById("tab-markdown");
        const previewTab = document.getElementById("tab-preview");

        // API Keys Modal elements
        const apiKeysModal = document.getElementById("api-keys-modal");
        const modalGithubTokenInput = document.getElementById("modal-github-token");
        const modalGeminiTokenInput = document.getElementById("modal-gemini-token");
        const modalSaveKeysBtn = document.getElementById("modal-save-keys-btn");
        const modalCloseBtn = document.getElementById("modal-close-btn");

        // Set to store unique tags
        let tags = new Set();
        // Array to store available README sections and their default checked state
        const availableSections = [
            { id: "description", name: "Deskripsi", checked: true },
            { id: "gallery", name: "Galeri Proyek", checked: true },
            { id: "features", name: "Fitur Utama", checked: true },
            { id: "techStack", name: "Tech Stack", checked: true },
            { id: "installation", name: "Instalasi & Menjalankan", checked: true },
            { id: "contributing", name: "Cara Berkontribusi", checked: true },
            { id: "license", name: "Lisensi", checked: true },
            { id: "acknowledgements", name: "Penghargaan", checked: false }, // Optional section
            { id: "contact", name: "Kontak", checked: false } // Optional section
        ];

        // --- Initialization ---
        // Load saved API tokens from local storage
        githubTokenInput.value = localStorage.getItem("githubApiToken") || "";
        geminiTokenInput.value = localStorage.getItem("geminiApiKey") || "";
        // Add the first image input field on load
        addNewImageInput(true);
        // Render initial checkboxes for README sections
        renderSectionsCheckboxes();

        // Show the API keys modal if either key is missing from local storage
        if (
          !localStorage.getItem("githubApiToken")?.trim() ||
          !localStorage.getItem("geminiApiKey")?.trim()
        ) {
          apiKeysModal.classList.remove("hidden"); // Display the modal
          // Pre-fill modal inputs with existing values if any
          modalGithubTokenInput.value = githubTokenInput.value;
          modalGeminiTokenInput.value = geminiTokenInput.value;
        } else {
          apiKeysModal.classList.add("hidden"); // Keep modal hidden
        }

        // --- Event Listeners ---
        // Generate button click handler
        generateBtn.addEventListener("click", handleGenerateReadme);
        // Copy button click handler
        copyBtn.addEventListener("click", copyToClipboard);
        // Save GitHub Token button click handler
        saveGithubTokenBtn.addEventListener("click", () =>
          saveToken("githubApiToken", githubTokenInput.value, "GitHub")
        );
        // Save Gemini Token button click handler
        saveGeminiTokenBtn.addEventListener("click", () =>
          saveToken("geminiApiKey", geminiTokenInput.value, "Gemini")
        );
        // Add Image button click handler
        addImageBtn.addEventListener("click", () => addNewImageInput(false));
        // Tags input keydown handler (for 'Enter' key to add tags)
        tagsInput.addEventListener("keydown", handleTagInput);
        // Tags container click handler (for removing tags)
        tagsContainer.addEventListener("click", handleTagRemove);
        // Markdown tab click handler
        markdownTab.addEventListener("click", () => switchTab("markdown"));
        // Preview tab click handler
        previewTab.addEventListener("click", () => switchTab("preview"));

        // Modal event listeners
        modalSaveKeysBtn.addEventListener("click", () => {
          // Save tokens from modal inputs to local storage
          saveToken("githubApiToken", modalGithubTokenInput.value, "GitHub");
          saveToken("geminiApiKey", modalGeminiTokenInput.value, "Gemini");
          // Update main input fields with modal values
          githubTokenInput.value = modalGithubTokenInput.value;
          geminiTokenInput.value = modalGeminiTokenInput.value;
          apiKeysModal.classList.add("hidden"); // Hide the modal
        });
        // Close modal button click handler
        modalCloseBtn.addEventListener("click", () =>
          apiKeysModal.classList.add("hidden")
        );

        // --- Functions ---

        /**
         * Saves an API token to localStorage and displays a message.
         * @param {string} key - The localStorage key to store the token.
         * @param {string} value - The token value to save.
         * @param {string} name - A user-friendly name for the token (e.g., "GitHub", "Gemini").
         */
        function saveToken(key, value, name) {
          if (value.trim()) {
            localStorage.setItem(key, value.trim());
            showMessage("success", `Token API ${name} berhasil disimpan.`);
          } else {
            localStorage.removeItem(key); // Remove if value is empty
            showMessage("info", `Token API ${name} dihapus dari penyimpanan.`);
          }
        }

        /**
         * Adds a new input field for an image URL.
         * @param {boolean} isFirst - True if it's the first input being added (no remove button).
         */
        function addNewImageInput(isFirst = false) {
          const div = document.createElement("div");
          div.className = "flex items-center gap-3"; // Tailwind classes for flex layout
          div.innerHTML = `
            <input type="text" class="image-url-input w-full bg-gray-700 border border-indigo-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-500" placeholder="https://.../image.png">
            ${
              !isFirst // Only add remove button if it's not the first input
                ? '<button class="remove-image-btn text-red-400 hover:text-red-300 font-bold text-xl">&times;</button>'
                : ""
            }
          `;
          imageInputsContainer.appendChild(div);
          // Attach event listener for the remove button if it exists
          if (!isFirst) {
            div
              .querySelector(".remove-image-btn")
              .addEventListener("click", () => div.remove());
          }
        }

        /**
         * Handles adding new tags when 'Enter' key is pressed in the tags input.
         * @param {KeyboardEvent} e - The keyboard event object.
         */
        function handleTagInput(e) {
          if (e.key === "Enter") {
            e.preventDefault(); // Prevent form submission
            const tagText = tagsInput.value.trim().toLowerCase();
            if (tagText && !tags.has(tagText)) {
              tags.add(tagText); // Add tag to the Set
              const tagPill = document.createElement("div");
              tagPill.className = "tag-pill"; // Apply tag pill styling
              tagPill.innerHTML = `
                <span>${tagText}</span>
                <span class="tag-remove-btn" data-tag="${tagText}">&times;</span>
              `;
              tagsContainer.appendChild(tagPill); // Add tag pill to the container
            }
            tagsInput.value = ""; // Clear the input field
          }
        }

        /**
         * Handles removing tags when the remove button on a tag pill is clicked.
         * @param {MouseEvent} e - The mouse event object.
         */
        function handleTagRemove(e) {
          if (e.target.classList.contains("tag-remove-btn")) {
            e.target.parentElement.remove(); // Remove the entire tag pill element
            tags.delete(e.target.dataset.tag); // Remove tag from the Set
          }
        }

        /**
         * Renders the Markdown content into the preview pane using Marked.js.
         */
        function renderPreview() {
          // Extract plain text content from the editable readmeOutput div
          let markdownText = extractMarkdownFromContent(readmeOutput).trim();

          // Remove potential markdown code block wrappers if present
          if (
            markdownText.startsWith("```markdown") &&
            markdownText.endsWith("```")
          ) {
            markdownText = markdownText
              .replace(/^```markdown/, "")
              .replace(/```$/, "")
              .trim();
          }

          // Convert Markdown to HTML and set it as innerHTML of the preview pane
          previewPane.innerHTML = `<div class="markdown-body">${marked.parse(
            markdownText
          )}</div>`;
        }

        /**
         * Extracts plain markdown text from a contenteditable div,
         * converting HTML elements like <div> and <br> into newlines.
         * It also decodes HTML entities.
         * @param {HTMLElement} element - The contenteditable HTML element.
         * @returns {string} The extracted plain markdown text.
         */
        function extractMarkdownFromContent(element) {
          let html = element.innerHTML;

          // Replace various HTML tags with appropriate markdown newlines or empty strings
          return html
            .replace(/<\/p>/gi, "\n\n") // Paragraph closing tag to double newline
            .replace(/<br\s*\/?>/gi, "\n") // Line break to single newline
            // Remove other common HTML tags, leaving their content
            .replace(/<\/?(div|span|strong|em|b|i|u|code|pre|h\d)[^>]*>/gi, "")
            .replace(/&nbsp;/g, " ") // Decode non-breaking space
            .replace(/&gt;/g, ">")   // Decode greater than
            .replace(/&lt;/g, "<")   // Decode less than
            .replace(/&amp;/g, "&")  // Decode ampersand
            .trim(); // Trim leading/trailing whitespace
        }

        /**
         * Switches between Markdown and Preview tabs.
         * @param {string} tabName - The name of the tab to switch to ('markdown' or 'preview').
         */
        function switchTab(tabName) {
          const isMarkdown = tabName === "markdown";

          // Toggle visibility of the panes
          markdownPane.classList.toggle("hidden", !isMarkdown);
          previewPane.classList.toggle("hidden", isMarkdown);

          // Update active/inactive styles for tab buttons
          markdownTab.classList.toggle("bg-gray-800", isMarkdown);
          markdownTab.classList.toggle("text-white", isMarkdown);
          markdownTab.classList.toggle("text-gray-400", !isMarkdown);
          markdownTab.classList.toggle("hover:bg-gray-800/50", !isMarkdown);
          markdownTab.classList.toggle("rounded-tl-lg", true); // Ensure top-left is always rounded when active

          previewTab.classList.toggle("bg-gray-800", !isMarkdown);
          previewTab.classList.toggle("text-white", !isMarkdown);
          previewTab.classList.toggle("text-gray-400", isMarkdown);
          previewTab.classList.toggle("hover:bg-gray-800/50", isMarkdown);
          previewTab.classList.toggle("rounded-tr-lg", true); // Ensure top-right is always rounded when active


          // If switching to preview, render the markdown content
          if (!isMarkdown) {
            renderPreview();
          }
        }

        /**
         * Sets the loading state of the generate button and displays initial messages.
         * @param {boolean} isLoading - True to show loading state, false to hide.
         */
        function setLoading(isLoading) {
          generateBtn.disabled = isLoading; // Disable button while loading
          btnText.textContent = isLoading ? "Memproses..." : "Hasilkan README"; // Change button text
          loader.classList.toggle("hidden", !isLoading); // Show/hide spinner
          if (isLoading) {
            // Display initial loading message in the output area
            readmeOutput.innerHTML = `
              <p class="text-gray-400">Menganalisis repositori dan menghasilkan README.md, mohon tunggu...</p>
            `;
            // Re-render preview immediately for this loading message
            renderPreview();
          }
        }

        /**
         * Displays a temporary message in the message container.
         * @param {'error'|'success'|'info'} type - Type of message for styling.
         * @param {string} message - The message text.
         */
        function showMessage(type, message) {
          messageContainer.innerHTML = ""; // Clear previous messages
          const colors = {
            error: "bg-red-900 border-red-700 text-red-300",
            success: "bg-green-900 border-green-700 text-green-300",
            info: "bg-blue-900 border-blue-700 text-blue-300",
          };
          const div = document.createElement("div");
          div.className = `p-4 rounded-lg border ${colors[type] || colors.info}`;
          div.textContent = message;
          messageContainer.appendChild(div);

          // Automatically hide message after a few seconds
          setTimeout(() => {
            if (div) {
              div.style.transition = "opacity 0.5s";
              div.style.opacity = "0";
              setTimeout(() => div.remove(), 500); // Remove after transition
            }
          }, 4000); // Message visible for 4 seconds
        }

        /**
         * Renders the checkboxes for selecting README sections.
         */
        function renderSectionsCheckboxes() {
            sectionsCheckboxes.innerHTML = ''; // Clear existing
            availableSections.forEach(section => {
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="section-${section.id}" value="${section.id}" ${section.checked ? 'checked' : ''}
                           class="h-4 w-4 text-lime-500 focus:ring-lime-400 border-gray-600 rounded bg-gray-700">
                    <label for="section-${section.id}" class="ml-2 text-gray-300 cursor-pointer">${section.name}</label>
                `;
                sectionsCheckboxes.appendChild(div);
            });
        }

        /**
         * Gets the currently selected README sections from the checkboxes.
         * @returns {string[]} An array of IDs for the selected sections.
         */
        function getSelectedSections() {
            return Array.from(sectionsCheckboxes.querySelectorAll('input[type="checkbox"]:checked'))
                        .map(checkbox => checkbox.value);
        }


        /**
         * Main function to handle README generation process.
         * Fetches GitHub data, constructs prompt, calls Gemini API, and displays result.
         */
        async function handleGenerateReadme() {
          messageContainer.innerHTML = ""; // Clear messages before starting

          const userGeminiKey = localStorage.getItem("geminiApiKey");
          const userGithubKey = localStorage.getItem("githubApiToken");

          // Validate GitHub token
          if (!userGithubKey) {
            showMessage(
              "error",
              `GitHub Personal Access Token diperlukan. Silakan tambahkan di Pengaturan Lanjutan atau saat pertama kali membuka web.`
            );
            apiKeysModal.classList.remove("hidden"); // Show modal to prompt for keys
            return;
          }

          // Validate Gemini token or check daily limit
          if (!userGeminiKey) {
            const lastGenTimestamp = localStorage.getItem("lastGenerationTimestamp");
            if (lastGenTimestamp) {
              const timeDiff = new Date().getTime() - Number(lastGenTimestamp);
              const hoursPassed = timeDiff / (1000 * 60 * 60);
              if (hoursPassed < 24) {
                showMessage(
                  "error",
                  `Anda telah mencapai batas 1x generate per hari. Sisa waktu: ${(
                    24 - hoursPassed
                  ).toFixed(
                    1
                  )} jam. Tambahkan Gemini API Key untuk akses tanpa batas.`
                );
                return;
              }
            }
          }

          const url = githubUrlInput.value.trim();
          if (!url) {
            return showMessage("error", "URL Repositori GitHub tidak boleh kosong.");
          }
          const repoPath = parseGithubUrl(url);
          if (!repoPath) {
            return showMessage("error", "Format URL Repositori GitHub tidak valid.");
          }

          setLoading(true); // Show loading spinner and disable button
          switchTab("markdown"); // Switch to markdown tab to show loading message

          try {
            // Fetch repository details and file tree concurrently
            const [repoDetails, repoTree] = await Promise.all([
              fetchGithubApi(`https://api.github.com/repos/${repoPath}`, userGithubKey),
              fetchGithubApi(
                `https://api.github.com/repos/${repoPath}/git/trees/main?recursive=1`, userGithubKey
              ),
            ]);

            // Get image URLs from dynamic input fields
            const imageUrls = Array.from(
              document.querySelectorAll(".image-url-input")
            )
              .map((input) => input.value.trim())
              .filter(Boolean); // Filter out empty strings

            // Get selected customization options
            const selectedTone = toneSelect.value;
            const selectedAudience = audienceSelect.value;
            const selectedSections = getSelectedSections();

            // Create the prompt for the Gemini API
            const prompt = createPrompt(
              repoDetails,
              repoTree.tree.map((f) => f.path), // Extract file paths
              imageUrls,
              Array.from(tags), // Convert Set to Array
              selectedTone,
              selectedAudience,
              selectedSections
            );

            // Call the Gemini API to generate the README content
            const generatedReadme = await callGeminiApi(prompt, userGeminiKey);

            // Clean and display the generated Markdown
            const cleanedReadme = stripMarkdownWrapper(generatedReadme);

            // Set innerHTML to allow HTML entities and line breaks from the markdown output
            readmeOutput.innerHTML =
                '<div style="white-space: pre-wrap;">' +
                cleanedReadme
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/\n/g, "<br>") +
                '</div>' +
                // Hidden span to ensure the credit is copied with selection, but not visible
                `<span style="font-size:0.1px; opacity:0; user-select:text;">
\\n\\n---\\nREADME.md ini dihasilkan secara otomatis oleh [README Kustom AI](${window.location.href}) — dibuat dengan ❤️ oleh Gemini
</span>`;


            switchTab("preview"); // Switch to preview tab
            renderPreview(); // Render the preview of the generated markdown

            showMessage(
              "success",
              "README.md berhasil dibuat! Cek tab 'Pratinjau' untuk hasilnya."
            );

            // If no Gemini key was provided, record timestamp for daily limit
            if (!userGeminiKey) {
              localStorage.setItem(
                "lastGenerationTimestamp",
                new Date().getTime().toString()
              );
            }
          } catch (error) {
            console.error("Error generating README:", error);
            showMessage(
              "error",
              error.message || "Terjadi kesalahan yang tidak diketahui."
            );
            // Display error message directly in the output area
            readmeOutput.innerHTML = `
              <h2 class="text-red-400 font-bold">Gagal Membuat README</h2>
              <p class="text-red-300">**Error:** ${error.message}</p>
            `;
            renderPreview(); // Render the error message in preview too
          } finally {
            setLoading(false); // Hide loading spinner and enable button
          }
        }

        /**
         * Strips common markdown code block wrappers (e.g., ```markdown, ```) from a string.
         * @param {string} text - The input string.
         * @returns {string} The cleaned string.
         */
        function stripMarkdownWrapper(text) {
          return text
            .replace(/^```markdown/, "") // Remove ```markdown at the beginning
            .replace(/^```/, "") // Remove ``` at the beginning
            .replace(/```$/, "") // Remove ``` at the end
            .trim(); // Trim any remaining whitespace
        }

        /**
         * Parses a GitHub repository URL to extract the owner/repo path.
         * @param {string} url - The GitHub repository URL.
         * @returns {string|null} The 'owner/repo' string or null if invalid.
         */
        function parseGithubUrl(url) {
          const match = url.match(/github\.com\/([^\/]+\/[^\/]+)(?:\/|$|\.git)/);
          return match ? match[1].replace(".git", "") : null;
        }

        /**
         * Fetches data from the GitHub API.
         * @param {string} apiUrl - The GitHub API endpoint URL.
         * @param {string} token - The GitHub Personal Access Token.
         * @returns {Promise<Object>} The JSON response from the API.
         * @throws {Error} If the API request fails or returns an error.
         */
        async function fetchGithubApi(apiUrl, token) {
          const headers = { Accept: "application/vnd.github.v3+json" };
          if (token) {
            headers["Authorization"] = `Bearer ${token}`;
          }
          const response = await fetch(apiUrl, { headers });
          if (!response.ok) {
            // Handle specific GitHub API error statuses
            if (response.status === 401)
              throw new Error(`Token GitHub tidak valid. Silakan periksa token Anda.`);
            if (response.status === 404)
              throw new Error(`Repositori tidak ditemukan atau branch 'main' tidak ada. Pastikan URL benar dan repo memiliki branch 'main'.`);
            if (response.status === 403)
              throw new Error(`Batas API GitHub terlampaui. Mungkin token Anda salah atau telah mencapai batas permintaan.`);
            throw new Error(`Error dari GitHub API (status: ${response.status})`);
          }
          return response.json();
        }

        /**
         * Constructs the detailed prompt string for the Gemini API based on repository data and user inputs.
         * @param {Object} repoDetails - GitHub repository details (name, description, language, html_url).
         * @param {string[]} files - List of file paths in the repository.
         * @param {string[]} imageUrls - List of image/GIF URLs provided by the user.
         * @param {string[]} tags - List of context tags provided by the user.
         * @param {string} tone - The desired tone for the README.
         * @param {string} audience - The target audience for the README.
         * @param {string[]} selectedSections - Array of section IDs to include.
         * @returns {string} The complete prompt string for Gemini.
         */
        function createPrompt(repoDetails, files, imageUrls, tags, tone, audience, selectedSections) {
          const repoName = repoDetails.name || "proyek GitHub";
          const repoDescription = repoDetails.description || "Tidak ada deskripsi yang disediakan. Harap berikan tebakan terbaik Anda berdasarkan file.";
          const repoLanguage = repoDetails.language || "Tidak terdeteksi";
          const repoUrl = repoDetails.html_url;
          const repoLicense = repoDetails.license ? repoDetails.license.name : "Tidak disebutkan";

          let promptSections = [];
          let currentSectionNumber = 1;

          // Main Title
          promptSections.push(`${currentSectionNumber}.  **Judul Proyek**: Gunakan nama proyek sebagai H1 dan buat nama yang lebih menarik dan relevan tanpa _underscore_. Tambahkan satu emoji yang paling relevan.`);
          currentSectionNumber++;

          // Badges
          promptSections.push(`${currentSectionNumber}.  **Badges**: Sertakan badge dari Shields.io untuk bahasa utama (${repoLanguage}) dan beberapa teknologi lainnya yang relevan dengan proyek (misal: "GitHub Workflow", "License"). Posisikan di tengah memanjang ke kanan dengan ada jarak style="margin-right: 8px;" di setiap badge agar tidak terlalu rapat.`);
          currentSectionNumber++;

          // Description
          if (selectedSections.includes('description')) {
              promptSections.push(`${currentSectionNumber}.  **Deskripsi 📝**: Jelaskan proyek dalam 1-2 paragraf yang menarik dan informatif, fokus pada apa yang dilakukan proyek dan mengapa itu berguna. Sesuaikan dengan nada **${tone}** dan audiens **${audience}**.`);
              currentSectionNumber++;
          }

          // Image Gallery
          if (selectedSections.includes('gallery') && imageUrls.length > 0) {
            let imageMarkdown;
            if (imageUrls.length === 1) {
              imageMarkdown = `\n<p align="center"><img src="${imageUrls[0]}" alt="Pratinjau Proyek" width="80%"></p>\n`;
            } else if (imageUrls.length <= 3) {
              const imagesHtml = imageUrls
                .map((url) => `<img src="${url}" alt="Pratinjau" width="32%">`)
                .join("\n");
              imageMarkdown = `\n<p align="center" style="display: flex; gap: 1%; justify-content: center;">${imagesHtml}</p>\n`;
            } else {
              const imagesHtml = imageUrls
                .map((url) => `<img src="${url}" alt="Pratinjau" width="48%">`)
                .join("\n");
              imageMarkdown = `\n<p align="center" style="display: flex; flex-wrap: wrap; gap: 2%; justify-content: center;">${imagesHtml}</p>\n`;
            }
            promptSections.push(`${currentSectionNumber}.  **Galeri Proyek 🖼️**: Tampilkan galeri ini:\n${imageMarkdown}`);
            currentSectionNumber++;
          }

          // Features
          if (selectedSections.includes('features')) {
              promptSections.push(`${currentSectionNumber}.  **Fitur Utama ✨**: Buat daftar 3-5 fitur unggulan. Gunakan sub-heading tebal dan daftar poin untuk setiap fitur dengan tanda yang menarik. Sesuaikan deskripsi fitur dengan audiens **${audience}**.`);
              currentSectionNumber++;
          }

          // Tech Stack
          if (selectedSections.includes('techStack')) {
              promptSections.push(`${currentSectionNumber}.  **Tech Stack 🛠️**: Sebutkan teknologi utama (bahasa, framework, database). Gunakan daftar poin dengan tanda yang menarik. Berikan tebakan cerdas jika informasi terbatas. Fokus pada teknologi yang paling relevan dengan repo.`);
              currentSectionNumber++;
          }

          // Installation
          if (selectedSections.includes('installation')) {
            let installCommand = 'Install dependensi: (Sarankan perintah yang benar berdasarkan file, misal `npm install` jika ada \'package.json\', atau `pip install -r requirements.txt` jika ada \'requirements.txt\').';
            if (files.includes('package.json')) {
                installCommand = 'Install dependensi: `npm install` atau `yarn install`';
            } else if (files.includes('requirements.txt')) {
                installCommand = 'Install dependensi: `pip install -r requirements.txt`';
            } else if (files.includes('go.mod')) {
                installCommand = 'Install dependensi: `go mod tidy`';
            } else if (files.includes('composer.json')) {
                installCommand = 'Install dependensi: `composer install`';
            }

            let runCommand = 'Jalankan proyek: (Sarankan perintah yang paling umum, misal `npm start` atau `python main.py`).';
            if (files.includes('package.json')) {
                runCommand = 'Jalankan proyek: `npm start`';
            } else if (files.includes('main.py') || files.includes('app.py')) {
                runCommand = `Jalankan proyek: \`python ${files.includes('main.py') ? 'main.py' : 'app.py'}\``;
            } else if (files.includes('index.js')) {
              runCommand = 'Jalankan proyek: `node index.js`';
            } else if (files.includes('pom.xml') || files.includes('build.gradle')) {
              runCommand = 'Jalankan proyek: `mvn spring-boot:run` atau `gradle bootRun`';
            } else if (files.some(file => file.endsWith('.go'))) {
              runCommand = `Jalankan proyek: \`go run ${files.find(file => file.endsWith('.go')) || ''}\``;
            }

              promptSections.push(`${currentSectionNumber}.  **Instalasi & Menjalankan 🚀**: Berikan panduan langkah-demi-langkah yang sangat jelas dan mudah diikuti serta dapat di copy dengan mudah.
                  - 1. Clone repositori: \`git clone ${repoUrl}\`
                  - 2. Masuk ke direktori: \`cd ${repoName}\`
                  - 3. ${installCommand}
                  - 4. ${runCommand}`);
              currentSectionNumber++;
          }

          // Contributing
          if (selectedSections.includes('contributing')) {
              promptSections.push(`${currentSectionNumber}. **Cara Berkontribusi 🤝**: Jelaskan cara berkontribusi dengan langkah-langkah standar (Fork, Branch, Commit, Pull Request). Dorong kontribusi dengan nada yang dipilih.`);
              currentSectionNumber++;
          }

          // License
          if (selectedSections.includes('license')) {
              promptSections.push(`${currentSectionNumber}. **Lisensi 📄**: Sebutkan lisensi proyek dari data (\`${repoLicense}\`). Jika tidak disebutkan, sarankan lisensi MIT. Tampilkan tautan ke lisensi jika ada (misal: \`[MIT License](LICENSE.md)\`).`);
              currentSectionNumber++;
          }

          // Acknowledgements (optional)
          if (selectedSections.includes('acknowledgements')) {
              promptSections.push(`${currentSectionNumber}. **Penghargaan 🙏**: Bagian opsional untuk menyebutkan siapa saja yang berkontribusi atau sumber daya yang digunakan.`);
              currentSectionNumber++;
          }

          // Contact (optional)
          if (selectedSections.includes('contact')) {
              promptSections.push(`${currentSectionNumber}. **Kontak 📧**: Informasi kontak untuk pertanyaan atau dukungan (misal: email, profil GitHub).`);
              currentSectionNumber++;
          }


          return `Sebagai seorang ahli rekayasa perangkat lunak dan penulis teknis yang kreatif, buatkan file README.md yang SANGAT BAGUS, profesional, jelas, dan mudah diaplikasikan untuk repositori GitHub berikut.
          Gunakan GAYA BAHASA YANG **${tone.toUpperCase()}** dan **${audience.toUpperCase()}** dengan banyak emoji yang relevan untuk menyorot poin penting. Fokus pada penulisan yang unik dan tidak generik.
          Data Repositori:
          - Nama: ${repoName}
          - Deskripsi: ${repoDescription}
          - Bahasa Utama: ${repoLanguage}
          - Link: ${repoUrl}
          - Files: ${files.slice(0, 50).join(", ")}
          ${tags.length > 0 ? `\n**Konteks Tambahan dari Pengguna (Referensi Kuat!):**\n- Tags: ${tags.join(", ")}\n` : ""}
          Struktur dan Instruksi README (Ikuti dengan SANGAT KETAT hanya bagian yang diminta):
          ${promptSections.join("\n")}

          Pastikan hasil AKHIR HANYA berupa konten Markdown mentah, tanpa penjelasan atau blok kode pembungkus. Pastikan juga semua link Shields.io badges memiliki style="margin-right: 8px;" dalam tag <img> atau <a> mereka untuk spasi yang benar.
          `;
        }

        /**
         * Calls the Gemini API to generate content.
         * @param {string} prompt - The prompt to send to the AI model.
         * @param {string} apiKey - The Gemini API key.
         * @returns {Promise<string>} The generated text from the AI.
         * @throws {Error} If the API call fails or the response is invalid.
         */
        async function callGeminiApi(prompt, apiKey) {
          if (!apiKey)
            throw new Error(
              "Gemini API Key tidak ditemukan. Silakan tambahkan di Pengaturan atau saat pertama kali membuka web."
            );

          // API endpoint for Gemini 2.0 Flash model
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
          const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            // Optional: Configure generation parameters if needed
            generationConfig: {
              temperature: 0.7, // Adjust creativity
              topK: 40,
              topP: 0.95,
            },
          };

          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            console.error("Gemini API Error:", errorData);
            throw new Error(
              `Error dari Gemini API: ${
                errorData.error?.message || response.statusText
              }`
            );
          }

          const data = await response.json();
          // Safely access the generated text from the response
          if (
            data.candidates &&
            data.candidates[0]?.content?.parts?.[0]?.text
          ) {
            return data.candidates[0].content.parts[0].text;
          } else {
            // Handle cases where the AI might not return content (e.g., due to safety filters)
            if (data.promptFeedback && data.promptFeedback.blockReason) {
                throw new Error(`Konten diblokir oleh filter keamanan AI: ${data.promptFeedback.blockReason}. Coba sesuaikan prompt Anda.`);
            }
            throw new Error("Gagal mengekstrak konten dari respons AI. Respon tidak valid.");
          }
        }

        /**
         * Copies the content of readmeOutput (plain markdown) to the clipboard.
         */
        function copyToClipboard() {
          let rawText = extractMarkdownFromContent(readmeOutput);

          // Remove any markdown code block wrappers
          if (rawText.startsWith("```markdown") && rawText.endsWith("```")) {
            rawText = rawText
              .replace(/^```markdown/, "")
              .replace(/```$/, "")
              .trim();
          }

          // Use a temporary textarea to copy text to clipboard
          try {
            const tempTextArea = document.createElement("textarea");
            tempTextArea.value = rawText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand("copy"); // Deprecated but widely supported in iframes
            document.body.removeChild(tempTextArea);

            showMessage("success", "Teks berhasil disalin.");
          } catch (err) {
            console.error("Failed to copy text:", err);
            showMessage("error", "Gagal menyalin teks.");
          }
        }
      });
    </script>
  </body>
</html>
